# План: Улучшение фоновой canvas-анимации — электрические/молниеобразные связи

## Контекст

Фоновая canvas-анимация на сайте Logic Architecture (`index.html`, строки ~1225-1313) отображает частицы, хаотично летающие по экрану. Периодически между близкими частицами возникают связи (connections). Сейчас связи — это **тонкие прямые линии** с fade-in/fade-out и «пакетом данных» (точка, путешествующая вдоль линии).

**Цель владельца:** связи должны выглядеть как **электричество/молния** — зигзагообразные пути, которые мерцают и меняются, плавно появляются и исчезают, с эффектом свечения.

**Файл:** `C:\Courses\docs\index.html` (single-file SPA, все изменения только в `<script>` блоке)

---

## Что меняется

### 1. Вспомогательные функции (добавляются перед `class Particle`)

| Функция | Назначение |
|---|---|
| `easeInCubic(t)` | Кубическое ускорение для fade-in (драматичное появление) |
| `easeOutCubic(t)` | Кубическое замедление для fade-out (плавное затухание) |
| `genLightningPts(ax,ay,bx,by,levels,disp)` | **Midpoint Displacement** — генерирует зигзагообразный путь между двумя точками. 4 уровня = 16 сегментов на десктопе, 3 уровня = 8 на мобильных |
| `strokeLightning(pts,color,lw,alpha)` | Рисует polyline по массиву точек с заданной толщиной и прозрачностью через `globalAlpha` |
| `genTendril(pts,idx)` | Генерирует короткое ответвление (тендрил) от точки на основном пути |

### 2. Новые конфиг-константы

```
LGHT_LEVELS      = 4 (desktop) / 3 (iOS)   — уровни рекурсии midpoint displacement
LGHT_DISP_RATIO  = 0.12                     — смещение = 12% от расстояния между частицами
LGHT_REGEN       = 3 (desktop) / 5 (iOS)    — регенерация пути каждые N кадров (мерцание)
LGHT_MAX_CONN    = 6 (desktop) / 3 (iOS)    — макс одновременных связей
LGHT_TENDRIL_CHANCE = 0.15 (desktop) / 0 (iOS) — вероятность ответвления
LGHT_FLICKER_SPEED  = 0.35                  — скорость мерцания в фазе hold
LGHT_FLICKER_AMP    = 0.25                  — амплитуда мерцания
```

Требуется перенести `isIOS` выше по коду (сейчас на строке ~1290), чтобы он был доступен при объявлении констант.

### 3. Перезапись класса `Connection`

**Конструктор:** добавляются `this.pts` (кэш точек молнии), `this.tendrils` (ответвления), `this.regenCounter`, метод `_regen()`. Цвет меняется с bare triplet (`'79,125,245'`) на `rgb()` строку для работы с `globalAlpha`.

**`_regen()`:** вызывает `genLightningPts()` для основного пути + с вероятностью `LGHT_TENDRIL_CHANCE` создаёт ответвления через `genTendril()`.

**`update()`:** добавлен счётчик `regenCounter` — каждые `LGHT_REGEN` кадров пересоздаёт зигзагообразный путь (эффект мерцания/дрожания молнии).

**`draw()`:** полная переработка:
- **Cubic easing fade** — `easeInCubic` при появлении, `easeOutCubic` при затухании, sine-flicker в фазе hold
- **Трёхслойный glow** (вместо `shadowBlur`, который дорогой):
  - Внешний: lineWidth 4, alpha × 0.18
  - Средний: lineWidth 2, alpha × 0.35
  - Ядро: lineWidth 0.7, alpha × 0.9
- **Тендрилы** рисуются в 2 слоя, тоньше и тусклее основной молнии
- **Data-packet** движется вдоль зигзагообразного пути (интерполяция по массиву точек), а не по прямой линии

### 4. Обновление `tryNewConnections()`

Заменить хардкод `6` на `LGHT_MAX_CONN` (2 места).

### 5. Перенос `isIOS` + добавление `isMobile`

Переместить детекцию `isIOS` со строки ~1290 выше — перед конфиг-константами. Добавить `isMobile` для Android-устройств.

---

## Что НЕ меняется

- Класс `Particle` — без изменений
- CSS — без изменений (glow реализован на canvas, не через CSS)
- HTML — без изменений
- `animate()` loop — без изменений (уже вызывает `update()`/`draw()` обобщённо)
- Орбы (`.orb--1/2/3`) — без изменений
- Навигация, табы, модалка — не затрагиваются

---

## Порядок реализации

1. Перенести `isIOS` выше + добавить `isMobile`
2. Добавить конфиг-константы `LGHT_*`
3. Добавить хелпер-функции (`easeInCubic`, `easeOutCubic`, `genLightningPts`, `strokeLightning`, `genTendril`)
4. Переписать класс `Connection` (constructor, `_regen()`, `update()`, `draw()`)
5. Обновить `tryNewConnections()` — `LGHT_MAX_CONN`
6. Удалить старое определение `isIOS` (чтобы не было дубля)

---

## Файлы

- **`C:\Courses\docs\index.html`** — единственный файл для редактирования (строки ~1225-1313 в `<script>` блоке)

---

## Проверка (через Chrome MCP расширение)

1. Открыть `https://logic-architecture.pages.dev` через Chrome
2. Дождаться появления связей (3-5 секунд)
3. ✅ Связи зигзагообразные, не прямые
4. ✅ Видно свечение (яркое тонкое ядро + широкий тусклый ореол)
5. ✅ Молния мерцает в фазе hold (пульсирует яркость)
6. ✅ Плавное появление (cubic ease-in) и затухание (cubic ease-out)
7. ✅ Точка data-packet движется вдоль зигзага
8. ✅ Иногда видны мелкие ответвления (тендрилы)
9. ✅ Частицы продолжают хаотично двигаться, мышь отталкивает
10. ✅ Вкладки переключаются, модалка работает
11. ✅ FPS стабильно 58-60 (Chrome DevTools Performance)
